---
title: "Does Removing rows with Missing GFR increases performance?"
author: "Halil Bilgin"
date: "7 Nisan 2017"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(pander)
source('../autoload.R', chdir=T)
```

## Does Removing rows with Missing GFR increases performance? 

10 Different training-test split was used to measure performance. Table below represents confidence intervals of the different scores.

```{r mainSetup}
algorithms <- loadClassifiers(c('lda', 'nb', 'glm', 'svmRadial'))
features <- featureSelection$aic(c(featureSelection$fm(db,F)), scaledDbNoNA)

result <- data.frame(
  method=character(),
  Accuracy=numeric(),
  AccuracyNull=numeric(),
  Sensitivity=numeric(),
  Specificity=numeric(),
  Kappa=numeric()
)
```

## Including Plots

You can also embed plots, for example:

```{r trainingModels, include=FALSE}
for(dbName in c('db', 'dbNoNA')) {
  sapply(names(algorithms), function(algorithm) {
    classifier <- get('algorithms')[[algorithm]]
    features <- get('features')
    for(i in 1:10) {
      set.seed(seed+i+1000)
      tt <- manipulations$trainTest(get(get('dbName')), p=0.75)
      scaledTt <- manipulations$scaledTrainTest(tt$train, tt$test)
      
      control <- trainControl(method="repeatedcv", number = 10, repeats=3, 
                              allowParallel = T)
      
      fit <- classifier(scaledTt$train, features[[1]], method=algorithm,
                        trControl=control)
      confMatrix <- confusionMatrix(predict(fit, newdata=scaledTt$test),
                                    scaledTt$test$gfrloss2)
      
      assign("result", rbind(get('result'), data.frame(
        method=paste(algorithm, dbName),
        Accuracy=confMatrix$overall['Accuracy'],
        AccuracyNull=confMatrix$overall['AccuracyNull'],
        Sensitivity=confMatrix$byClass['Sensitivity'],
        Specificity=confMatrix$byClass['Specificity'],
        Kappa=confMatrix$overall['Kappa']
      )), envir = .GlobalEnv)
      
    }
})
}
```

```{r printingTables}
result2 <- result[0, ]

c<-sapply(levels(result$method), function(method) {
  result <- get('result')
  x<- lapply(result[result$method == method,], function(x){
    if(! is.numeric(x)) {
      return(x[[1]])
    }
    tTest <- t.test(x)
    sMean <- round(tTest$estimate[[1]],3)
    sError <- round(tTest$estimate[[1]] - tTest$conf.int[1], 3)
    
    c(as.character(paste(sMean, '\u00B1', sError)))
    
  })
  
  levels(x$method) <- levels(result$method)
  x <- data.frame(x, stringsAsFactors=FALSE)
  assign('result2', rbind(get('result2'), x), envir = .GlobalEnv)

})

knitr::kable(result2, row.names = F)
```